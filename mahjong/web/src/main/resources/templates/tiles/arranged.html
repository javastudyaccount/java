<!DOCTYPE html>
<html lang="ja"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
<head>
    <title>All tiles arranged</title>
</head>
<body class="unselectable">
    <div layout:fragment="content">
    <div style="padding-left:50px;padding-right:50px">
    <table cellspacing="0" cellpadding="0" class="first_div">
		<tr class="first_div">
		<td th:each="i , iStat: ${#numbers.sequence(0, 16)}">
		   	<img class="back portrait" th:src="@{/images/back.png}"></img>
		</td>
		</tr>
	</table>
	</div>
	
	<div>
	<table class="second_div">
	<tr>
	<td>
    <table cellspacing="0" cellpadding="0">
		<tr class="rotate90deg" th:each="i , iStat: ${#numbers.sequence(0, 16)}">
		<td>
		   	<img class="back landscape" th:src="@{/images/back90deg.png}"></img>
		</td>
		</tr>
	</table>
	</td>
	<td align="right">
    <table cellspacing="0" cellpadding="0">
		<tr class="rotate90deg" th:each="i , iStat: ${#numbers.sequence(0, 16)}">
		<td>
		   	<img class="back landscape" th:src="@{/images/back90deg.png}"></img>
		</td>
		</tr>
	</table>
	</td>
	</tr>
	</table>
	</div>
	
    <div style="padding-left:50px;padding-right:50px">
    <table cellspacing="0" cellpadding="0">
		<tr>
		<td th:each="i , iStat: ${#numbers.sequence(0, 16)}">
		   	<img class="back portrait" th:src="@{/images/back.png}"></img>
		</td>
		</tr>
	</table>
	</div>	
	<figure>
    <audio style="width:0px;height:0px"
        controls
        th:src="@{/sounds/dice.mp3}">
            Your browser does not support the
            <code>audio</code> element.
    </audio>
    </figure>   
<script th:inline="javascript">
/*<![CDATA[*/
$(document).ready(function() {
	var height = $(window).height();
	var width = $(window).width();
	var size = Math.min(height, width);
	var ratio = $("img.portrait")[0].height / $("img.portrait")[0].width;
	var tileWidth = ((size - 2 * (size / 17 * ratio)) / 17) | 0;
	$("img.portrait").css({"width": tileWidth + 'px'});
	var tileHeight = $("img.portrait")[0].height;
	$("img.landscape").css({"width": tileHeight + 'px'});
    $(".second_div").css({
      'width': (($(".first_div").width() + 100) + 'px')
    });
    size = size - 2 * (size / 17 * ratio);
    size = size * 2;
    $("#dice1").css({"position":"absolute", "left": (size/2)+'px', "top": (size/2)+'px', "zoom": 0.5});
    $("#dice2").css({"position":"absolute", "left": (size/2 + 90)+'px', "top": (size/2)+'px', "zoom": 0.5});
    
    var diceFunc = function(){
    	$("audio")[0].play();
    	jQuery.each([$("#dice1"), $("#dice2")], function(index, dice){
            var left = parseInt($(dice).css("left").replace("px", ""));
            var top = parseInt($(dice).css("top").replace("px", ""));
            $(".wrap1").append("<div id='dice_mask'></div>");//add mask
            dice.attr("class","dice");//After clearing the last points animation
            dice.css('cursor','default');
            var num = Math.floor(Math.random()*6+1);//random num 1-6
            
            dice.animate({left: (left+2)+'px'}, 100,function(){
                dice.addClass("dice_t");
            }).delay(200).animate({top:(top-2)+'px'},100,function(){
                dice.removeClass("dice_t").addClass("dice_s");
            }).delay(200).animate({opacity: 'show'},600,function(){
                dice.removeClass("dice_s").addClass("dice_e");
            }).delay(100).animate({left:(left)+'px',top:(top)+'px'},100,function(){
                dice.removeClass("dice_e").addClass("dice_"+num);
                dice.css('cursor','pointer');
                $("#dice_mask").remove();//remove mask
                $("audio")[0].pause();
                $("audio")[0].currentTime = 0;
            });
    	});
    };
    var dice1 = $("#dice1");
    dice1.click(diceFunc);
    var dice2 = $("#dice2");
    dice2.click(diceFunc);
});
/*]]>*/
</script>
<div class="wrap1">
<div id="dice1" class="dice dice_1"></div>
</div>
<div class="wrap2">
<div id="dice2" class="dice dice_1"></div>
</div>
	</div>
</body>
</html>